[TOC]

## Shell简介

1. Shell是一个命令解释器，还是一个功能强大的编程语言，可以直接调用Linux系统命令
2. Bourne和C
   1. Bourne Shell主要包括 sh、ksh、Bash、psh、zsh
   2. C 主要包括csh、tcsh
3. Bash与sh兼容，现在使用的Linux就是使用Bash作为用户的基本Shell

## Shell的执行

1. echo 'hello world！'
2. echo [选项] [输出内容]
   1. -e 支持反斜线控制的字符转换
   2. 支持颜色输出
3. Shell的执行方式
   1. 程序可以输入绝对路径或相对路径执行
   2. 程序可以用bash 脚本名执行，这里不用赋予执行权限
4. dos2unix 文件名 快速从dos格式转化为unix文件格式

## Bash基本功能

1. history [选项] [历史命令保存文件]
   1. -c 清空历史命令
   2. -w 把缓存中的历史命令写入历史命令保存文件 ~/.bash_history
2. 历史命令默认会保存1000条，可以在环境变量配置文件/etc/profile中进行修改
3. 上下箭头调用以前命令
4. !n 重复执行第n条命令
5. !! 重复执行上一条命令
6. !字符串 重复执行最后一条该字串开头的命令
7. Tab 自动补全

## 命令的别名与常用快捷键

1. alias 别名='原命令'
2. 命令的执行顺序
   1. 绝对路径或相对路径的命令
   2. 别名
   3. Bash的内部命令
   4. 按照$PATH环境变量定义的目录查找顺序找到的第一个命令
3. 让别名永久生效需要修改 /root/.bashrc
4. 常用快捷键Ctrl+
   1. a 把光标移动到命令行开头
   2. e 把光标移动到命令行结尾
   3. c 强制终止当前的命令
   4. l 清屏
   5. u 删除或剪切光标之前的命令
   6. k 删除或剪切光标之后的命令
   7. y 粘贴u、k剪切的命令
   8. r 在历史命令中搜索
   9. d 退出当前终端
   10. z 暂停
   11. s 暂停屏幕输出
   12. q 恢复屏幕输出

## 输入输出重定向

1. 标准输入输出 键盘、显示器
   1. 0 标准输入
   2. 1 标准输出
   3. 2 标准错误输出、
2. 输出重定向
   1. 标准重定向
      1. 命令 > 文件 覆盖方式
      2. 命令 >> 文件 追加方式
   2. 标准错误重定向
      1. 错误命令 2> 覆盖
      2. 错误命令 2>> 追加
   3. 正确和错误同时保存
      1. 命令 > 文件 2>&1 或者 命令 &>文件 覆盖
      2. 命令 >> 文件 2>&1 或者 命令 &>文件 覆盖
      3. 命令>>文件1 2>>文件2 分开保存
   4. /dev/null 是垃圾项，可以将部分命令的输出直接丢入该目录
3. 输入重定向
   1. wc [选项] [文件名] 统计命令
   2. -c 统计字节数
   3. -w 统计单词数
   4. -l 统计行数

## 多命令顺序执行与管道符

1. 多命令
   1. ; 顺序执行
   2. && 逻辑与
   3. || 逻辑或
   4. dd [选项] 命令 磁盘对拷命令
      1. if=输入文件 制定源文件或源设备
      2. of=输出文件 制定目标文件或目标设备
      3. bs=字节数 制定一次输入/输入多少字节，即把这些字节看作一个数据块
      4. count=个数 制定输入/输出多少个数据块
   5. /dev/zero 是0
2. 管道符 |
   1. 命令1 的正确输出作为 命令2的操作对象 例如 ll -a /etc | more    、    netstat -an | gerp "ESTABLISHED"
3. 通配符和其他特殊符号
   1. 通配符
      1. '?' 一个字符
      2. '*' 任意多个字符
      3. '[]' 任意一个字符
      4. '[-]' 匹配任意一个字符 -代表一个范围
      5. '[^]' 逻辑非，不匹配字符
   2. 特殊字符
      1. '' 单引号，其中的所有字符都没有特殊含义
      2. "" 双引号 特殊符号没有特殊含义
         1. $ 调用变量值
         2. ` 引用命令
         3. \ 转义字符
      3. `` 系统命令，Bash会先执行他
      4. $() 和反引号作用一样，建议使用此条
      5. #在Shell脚本中，#开头代表注释

## 用户自定义变量

1. 变量设置规则
   1. 变量名称可以由字母、数字、下划线组成，但不能以数字开头
   2. Bash中，变量的默认类型都是字符串，如果要进行数值运算，则必须制定变量类型
   3. 变量用=赋值，如果有空格则需要引起
   4. 变量值可以使用\
   5. 如果需要增加变量的值，可以进行变量值叠加，用"$变量名"或用${变量名}包含
   6. 也可以把命令的结果赋值
   7. 环境变量名建议大写
2. 变量分类
   1. 用户自定义变量
      1. echo $变量名 申明变量
      2. set 查询变量
      3. unset 变量名 删除变量
   2. 环境变量
      1. 变量操作
         1. 用户自定义变量在当前Shell中生效，而环境变量会在子Shell中也生效。如果把这个环境变量写入相应的配置文件，那么这个环境变量就会在所有的Shell中生效
         2. export 变量名=变量值 申明变量
         3. env 查询变量
         4. unset 变量名 删除变量
      2. PATH 变量是系统查找命令的路径，用:隔开
         1. 临时改变环境变量中的PATH PATH="$PATH":/root
      3. PS1 用户提示符
   3. 位置参数变量，脚本当中传递参数或数据，变量名不能自定义，作用固定
      1. $n n为数字，0代表命令本身，1~9代表第一到第九个参数，十个以上的参数需要用大括号包含
      2. $* 这个变量代表命令行中所有的参数，$*把所有的参数看成一个整体
      3. $@ 这个变量也代表命令行中所有的参数，不过把每个参数区分对待
      4. $# 这个变量代表命令行中所有参数的个数
   4. 预定义变量，是Bash中已经定义好的变量，变量名不能自定义，作用固定
      1. $? 最后一次执行的命令的返回状态，0为正确执行，非0为执行错误
      2. $$ 当前进程的进程号
      3. $! 后台运行的最后一个进程号
      4. & 代表后台执行，在进程后加&即为后台执行
   5. 接受键盘输入
      1. read [选项] [变量名]
         1. -p 提示信息 在等待read输入时输出提示信息
         2. -t 单位s read命令会一直等待用户输入，使用此选项可以指定等待时间
         3. -n 字符数 read命令只接受指定的字符数就会执行
         4. -s 隐藏输入的数据，适用于机密信息输入

## Bash的运算符

1. declare [+/-] [选项] 变量名 声明变量类型

   1. "-" 给变量设定类型属性
   2. "+" 取消变量的类型属性
   3. -i 将变量声明为整数型
   4. -x 将变量声明为环境变量
   5. -p 显示指定变量的被声明的类型

2. expr或let数值运算工具

   1. declare方式

      ```shell
      declare -i dd=$aa+$bb
      ```

   2. expr方式

      ```shell
      dd=$(expr $aa + $bb)
      ```

   3. let方式

      ```shell
      dd=$(($aa+$bb))
      ```

3. 其他运算符与C类似

## 变量测试与内容替换

1. 变量测试表

## 环境变量配置文件

1. 环境变量
2. source 命令 source配置文件 或 .配置文件 使环境变量生效
3. 系统默认环境变量有PATH、HISTSIZE、PS1、HOSTNAME等
4. 系统环境变量配置文件
   1. /etc/profile
      1. 定义一些系统变量USER LOGNAME MAIL PATH HOSTNAME HISTSIZE umask
      2. 调用/etc/profile.d/*.sh
   2. /etc/profile.d/*.sh
   3. ~/.bash_profile
   4. ~/.bashrc
   5. /etc/bashrc
5. etc下是对所有用户生效
6. 其他配置文件和登录信息
   1. ~/.bash_logout 注销时生效的环境变量配置文件
   2. ~/bash_history 历史命令
   3. /etc/issue 支持一些转义字符标记的变量 只对本地登录有效
   4. /etc/issue.net 该文件是纯文本
   5. 是否显示4的欢迎信息，由ssh的配置文件/etc/ssh/sshd_config决定，加入"Banner /etc/issue.net"行才能显示，要重启ssh服务
   6. 登录后欢迎信息 /etc/motd 本地远程登录皆生效


## Shell编程

1. 正则表达式
   1. 正则表达式
      1. 正则表达式用来匹配符合条件的字符串，是包含匹配，支持grep、awk、sed等命令
      2. 通配符用来匹配符合条件的文件名，是完全匹配，ls、find、cp这些命令不支持正则表达式
   2. 基础正则表达式
      1. \* 前一个字符匹配0次或者任意多次
      2. \. 匹配除了换行符外任意一个字符
      3. ^ 匹配行首
      4. $ 匹配行尾
      5. [] 匹配中括号指定的任意字符，只匹配一个祖父
      6. [^] 匹配除中括号的字符以外的任意字符
      7. \ 转义符
      8. \\{n\\} 表示其前面的字符恰好出现n次
      9. \\{n,\\} 表示其前面的字符出现不小于n次
      10. \\{n,m\\} 表示其前面的字符至少出现不小于n次
2. 字符截取命令
   1. cut [选项] 文件名 字段提取命令
      1. -f 列号 提取第几列
      2. -d 分隔符 按照指定分隔符分割列
      3. 列和列之间如不指定必须是制表符
   2. printf '输出类型输出格式' 输出内容
      1. 输出类型
         1. %ns 输出字符串，n是数字指代输出几个字符
         2. %ni 输出整数，n是数字指代输出几个数字
         3. %m.nf 输出浮点数 m和n是数字，指代输出的证书位数和小数位数
      2. 输出格式
         1. \a 输出警告声音
         2. \b 输出退格键
         3. \f 清楚屏幕
         4. \n 换行
         5. \r 回车
         6. \t 水平输出退格键
         7. \v 垂直输出退格键
      3. 这是标准输出格式
      4. print会在每次输出后加入换行，Linux没有print（awk命令）
   3. awk命令（awk编程）
      1. awk '条件1{动作1} 条件2{动作2}...' 文件名
      2. 条件，一般使用关系表达式作为条件
      3. 动作，格式化输出、流程控制语句
      4. BEGIN 在所有命令前线执行BEGIN的命令
      5. FS内置变量可以指定分隔符，这里要注意，在执行awk命令时已经读入了第一行，故如果要处理第一行需要加入BEGIN命令
   4. sed命令
      1. 轻量流编辑器，用来将数据进行选取、替换、删除、新增
      2. sed [选项] '[动作]' 文件名
         1. -n 把只经过sed命令处理的行输出
         2. -e 允许输入数据应用多条sed命令 多个命令用;隔开
         3. -i 修改的数据直接返回文件
      3. 动作 行数区间+下面的命令（除6以外）
         1. a\ 追加 行 如果追加多行，需要行末加入\，最后一行不用加入
         2. c\ 行替换 
         3. i\ 插入行，在前插入
         4. d 删除行
         5. p 打印行
         6. s 子串替换 类似于vim，sed 's/旧字符串/新字符串/g' 文件名
   5. 字符处理命令
      1. sort [选项] 文件名
         1. -f 忽略大小写
         2. -n 以淑智型进行排序，默认是字符串
         3. -r 反向排序
         4. -t 指定分隔符,默认是制表符
         5. -k n[,m] 按指定的字段范围排序
      2. wc [选项] 文件名 统计命令
         1. -l 只统计行数
         2. -w 只统计单词数
         3. -m 只统计字符数

## 流程控制语句

1. 条件判断
   1. 文件类型判断
      1. 选项
         1. -b 文件 是否为块设备文件
         2. -c 文件 是否为字符设备文件
         3. -d 文件 是否为目录文件
         4. -e 文件 是否存在
         5. -f 文件 是否存在且为普通文件
         6. -L 文件 是否存在且为符号链接文件
         7. -p 文件 是否存在为管道文件
         8. -s 文件 是否存在为非空
         9. -S 文件 是否存在为套接字文件
      2. test [选项] 文件名 判断格式
      3. [ [选项] 文件名 ] 判断格式
   2. 文件权限判断
      1. -r 文件 是否存在且拥有读权限
      2. -w 文件 是否存在且拥有写权限
      3. -x 文件 是否存在且拥有执行权限
      4. -u 文件 是否存在且拥有SUID权限
      5. -g 文件 是否存在且拥有SGID权限
      6. -k 文件 是否拥有且拥有SBit权限
   3. 两个文件之间进行比较
      1. 文件1 -nt 文件2 判断文件1的修改时间是否比文件2的新
      2. 文件1 -ot 文件2 判断文件1的修改时间是否比文件2的旧
      3. 文件1 -ef 文件2 判断文件1是否和文件2的Inode号一直，可以理解为是否为同一个文件，可以用来判断硬链接
   4. 两个整数之间比较
      1. 整数1 -eq 整数2 判相等
      2. 整数1 -ne 整数2 判不等
      3. 整数1 -gt 整数2 判大于
      4. 整数1 -lt 整数2 判小于
      5. 整数1 -ge 整数2 判大于等于
      6. 整数1 -le 整数2 判小于等于
   5. 字符串的判断
      1. -z 字符串 是否为空
      2. -n 是否为非空
      3. ==（=） 是否相等
   6. 多重条件判断
      1. -a 与
      2. -o 或
      3. ! 非

2. if语句

    ```shell
    if 条件判断式; then
        程序
    fi
    
        或者
    
    if 条件判断式
        then
        程序
    elif 条件判断式
        then
        程序
    else
        程序
    fi
    # 
    ```

3. case语句

    ```shell
    case $变量名 in
    	"值1")
    		程序
    		;;
    	"值2")
    		程序
    		;;
    	"值3")
    		程序
    		;;
    esac
    ```

4. for循环

    ```shell
    # 1
    for 变量 in 值1 值2 值3...
    	do
    		程序
    	done
    	
    # 2
    # ((i=0;i<n;i=i+1))
    for ((初始值;循环条件;变量条件))
    	do
    		程序
    	done
    ```

5. while循环与until循环

    ```shell
    # while循环 循环成立执行
    while [条件判断式]
    	do
    		程序
    	done
    	
    # until循环 循环不成立执行
    until [条件判断式]
    	do
    		程序
    	done
    ```

## 服务管理

1. 服务的分类

   1. RPM包默认安装的服务
      1. 独立的服务
      2. 基于xinetd服务
   2. 源码包安装的服务

2. 查询已安装的服务

   1. RPM包安装的服务
      1. chkconfig --list 查看服务自启动状态，可以查看RPM包安装的服务，2、3、4、5开启则自启动
      2. ps aux 如果有则服务存在
      3. netstat -tlun（有缺陷，守护进程没有端口无法查看）
   2. 源码包安装的服务
      1. 查看服务安装位置，一般是/usr/local/下
   3. 注意service 和 chkconfig一般情况下只能查看RPM包安装的服务，原因是两条命令查询的是/etc/rc.d/init.d

3. 配置文件目录

   1. /etc/rc.d/init.d或/etc/init.d 独立服务的脚本位置
   2. /etc/sysconfig 初始化环境配置文件配置
   3. /etc/ 配置文件位置
   4. /etc/xinetd.conf xinetd配置文件
   5. /etc/xinetd.d 基于xinetd服务的启动脚本
   6. /var/lib 服务产生的数据放在这里
   7. /var/log 日志

4. 独立服务

   1. 独立服务的启动
      1. /etc/init.d/独立服务 start|stop|status|restart
      2. service 独立服务名 start|stop|status||restart （红帽专有）
         1. service --status-all 列出所有已经安装RPM包运行状态
   2. 独立服务的自启动
      1. chkconfig --level 2345 服务名 on|off （默认就是--level 2345）
      2. 修改 /etc/rc.d/rc.local 加入启动命令 建议使用
      3. 使用ntsysv（红帽专属）

5. 基于xinetd服务管理（超级守护进程）

   1. 先装xinetd
   2. 基于xinetd的服务越来越少

6. 源码包服务管理

   1. 将源码包加入管理 做一个软连接，将启动脚本链接到启动服务的管理包中

   2. 不推荐链接，自启动可以采用加入启动命令的方式

   3. 让源码包被chkconfig与ntsysv命令管理自启动 vi /etc/init.d/apache

      ```shell
      # chkconfig: 35 86 76
      # 运行级别 启动顺序 关闭顺序
      # description: source package apache
      # 说明，内容随意
      ```

   4. rc.d下的目录中包含启动和关闭顺序

   5. chkconfig --add apache

   6. chkconfig --del

## 系统管理

1. 进程管理 查看进程
   1. ps aux 查看系统中所有进程，使用BSD操作系统格式
   2. ps -le 使用Linux标准命令格式
2. 进程输出含义
   1. USER 进程用户
   2. PID 进程id 1号进程是init进程
   3. %CPU 进程占用CPU
   4. %MEM 进程占用内存
   5. VSZ 进程占用虚拟内存KB
   6. RSS 进程占用实际物理内存KB
   7. TTY 进程在那个中段运行，tty1~tty7代表本地控制终端，tty1~tty6本地控制台中段，tty7是图形终端，pts/0~256代表虚拟终端
   8. STAT 进程状态 常见： R运行 S睡眠 T停滞状态 s包含子进程 +位于后台
   9. START 该进程的启动时间
   10. TIME 该进程占用CPU的运算事件
   11. COMMAND 产生进程的命令名
3. top [选项] 查看健康状态
   1. 选项
      1. -d 秒数 指定top命令每个多长时间更新，默认3s
      2. ?或h 显示监护模式的帮助
      3. P 以CPU使用率排序，默认就是此项
      4. M 以内存使用率排序
      5. N 以PID排序
      6. q 退出
   2. top命令输出含义
      1. 登陆时间、系统负载
      2. 进程
      3. cpu
      4. 内存
      5. 虚拟内存
4. pstree 查看进程依赖关系 进程树
   1. -p显示pid
   2. -u user
5. 杀死进程
   1. kill -l 查看支持信号 kill [-选项] pid
      1. 1 立即关闭，然后读取配置文件重启
      2. 9 强制关闭
      3. 15 关闭进程（默认）
   2. killall [选项] [信号] 进程名
      1. -i 交互式
      2. -I 忽略大小写
   3. pkill [选项] [信号] 进程名
      1. -t 终端号t出用户
6. 后台运行进程
   1. 后台运行
      1. 命令后加 & 在后台运行
      2. ctrl+z快捷键 在后台暂停运行
   2. 查看后台工作
      1. jobs [-l] 显示工作的PID
      2. +代表最近一个放入后台的工作，-代表倒数第二个放入后台的工作
   3. fg %工作号，%可以省略，恢复工作到前台
   4. bg %工作号，%可以省略，恢复工作到后台
   5. 注意前台有交互的命令不能放到后台运行
7. 系统资源查看
   1. vmstat [刷新延时 刷新次数] 监控系统资源
   2. dmesg 开机时内核监测信息
   3. free [选项] 查看内存使用状态
      1. -b 字节为单位
      2. -k KB为单位
      3. -m MB为单位
      4. -g GB为代为
      5. -h 自动
   4. 缓存与缓冲的区别
      1. 简单来说，缓存用来加速数据从磁盘读取，缓冲用来加速数据写入磁盘